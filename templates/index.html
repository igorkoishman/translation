<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Auto Subtitle Generator</title>
  <style>
    /* Reset some */
    * {
      box-sizing: border-box;
    }
    html, body {
      height: 100%;
      margin: 0;
      font-family: Arial, sans-serif;
      background: #f5f7fa;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    body {
      padding: 20px;
    }
    .container {
      background: white;
      padding: 30px 40px;
      border-radius: 8px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.1);
      max-width: 480px;
      width: 100%;
    }
    h1 {
      text-align: center;
      margin-bottom: 30px;
      color: #333;
    }
    form {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px 20px;
      align-items: center;
    }
    form label {
      justify-self: end;
      font-weight: 600;
      color: #555;
    }
    form input[type="file"],
    form input[type="text"],
    form select {
      width: 100%;
      padding: 8px 10px;
      border-radius: 4px;
      border: 1px solid #ccc;
      font-size: 1rem;
      color: #333;
    }
    form input[type="checkbox"] {
      justify-self: start;
      width: auto;
      transform: scale(1.2);
      cursor: pointer;
    }
    form button {
      grid-column: 1 / -1;
      padding: 12px;
      font-size: 1.1rem;
      background: #007bff;
      border: none;
      color: white;
      border-radius: 6px;
      cursor: pointer;
      transition: background 0.3s ease;
    }
    form button:hover {
      background: #0056b3;
    }
    #progress {
      margin-top: 20px;
      font-weight: 700;
      color: green;
      text-align: center;
    }
    #result {
      margin-top: 15px;
      text-align: center;
    }
    #result .output-link {
      margin-top: 8px;
    }
    #result a {
      color: #007bff;
      font-weight: 600;
      text-decoration: none;
    }
    #result a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Auto Subtitle Generator</h1>

    <form id="upload-form" enctype="multipart/form-data">
      <label for="file-input">Select Video File:</label>
      <input type="file" name="file" id="file-input" required />

      <label for="langs">Languages (e.g. he ru):</label>
      <input type="text" name="langs" id="langs" placeholder="Languages (e.g. he ru)" />

      <label for="align">Align Words?</label>
      <input type="checkbox" name="align" id="align" checked />

      <label for="model_type">Model Type:</label>
      <select name="model_type" id="model_type" required>
        <option value="faster-whisper">faster-whisper</option>
        <option value="openai-whisper">openai-whisper</option>
      </select>

      <label for="model">Model:</label>
      <select name="model" id="model" required></select>

      <button type="submit">Upload &amp; Process</button>
    </form>

    <div id="progress"></div>
    <div id="result"></div>
  </div>

  <script>
  // Your existing script (same as you had, unchanged)
  document.addEventListener('DOMContentLoaded', () => {
    const form = document.getElementById('upload-form');
    const modelTypeSelect = document.getElementById('model_type');
    const modelSelect = document.getElementById('model');

    const modelsByBackend = {
      'faster-whisper': ['tiny', 'base', 'small', 'medium', 'large-v1', 'large-v2', 'large-v3', 'large'],
      'openai-whisper': [
        'tiny', 'tiny.en', 'base', 'base.en', 'small', 'small.en', 'medium', 'medium.en',
        'large', 'large-v1', 'large-v2', 'large-v3',
        'distil-small.en', 'distil-medium.en', 'distil-large-v2', 'distil-large-v3',
        'large-v3-turbo', 'turbo'
      ]
    };

    function updateModelOptions() {
      const selectedBackend = modelTypeSelect.value;
      const modelOptions = modelsByBackend[selectedBackend] || [];

      modelSelect.innerHTML = '';
      for (const model of modelOptions) {
        const option = document.createElement('option');
        option.value = model;
        option.textContent = model;
        modelSelect.appendChild(option);
      }
    }

    modelTypeSelect.addEventListener('change', updateModelOptions);
    updateModelOptions();

    form.onsubmit = async (e) => {
      e.preventDefault();

      const fileInput = document.getElementById('file-input');
      const langs = document.getElementById('langs').value;
      const model = modelSelect.value;
      const model_type = modelTypeSelect.value;
      const align = document.getElementById('align').checked;

      const formData = new FormData();
      formData.append('file', fileInput.files[0]);
      formData.append('langs', langs);
      formData.append('model', model);
      formData.append('backend', model_type);
      formData.append('align', align);

      document.getElementById('progress').innerText = 'Uploading...';
      document.getElementById('result').innerHTML = '';

      try {
        const res = await fetch('/upload', { method: 'POST', body: formData });
        const data = await res.json();

        if (!data.job_id) {
          document.getElementById('progress').innerText = 'Error: No job_id received';
          return;
        }

        document.getElementById('progress').innerText = 'Processing...';
        checkStatus(data.job_id);
      } catch (err) {
        console.error(err);
        document.getElementById('progress').innerText = 'Upload failed.';
      }
    };

    async function checkStatus(job_id) {
  try {
    const res = await fetch('/status/' + job_id);
    const data = await res.json();

    if (data.status === 'done') {
      let outputHTML = '<p>Download Results:</p>';

      for (const [label, fileName] of Object.entries(data.outputs)) {
        outputHTML += `
          <div class="output-link">
            <a href="/download/${fileName}" target="_blank">${label}</a>
          </div>`;
      }

      if (data.duration_seconds) {
      outputHTML += `<p><strong>Processing Time:</strong> ${data.duration_seconds} seconds</p>`;
      }

      document.getElementById('result').innerHTML = outputHTML;
      document.getElementById('progress').innerText = 'Done!';
    } else if (data.status === 'failed') {
      document.getElementById('progress').innerText = 'Processing failed.';
    } else {
      setTimeout(() => checkStatus(job_id), 2000);
    }
  } catch (err) {
    console.error(err);
    document.getElementById('progress').innerText = 'Error checking status.';
  }
}
  });
  </script>
</body>
</html>
